import{c as L,k as $,j as e,B as F,a as B,L as z,h as M,z as k,d as N}from"./index-BDlxOAt8.js";import{u as R,b as _,r as x,L as u}from"./react-vendor-5iokPOny.js";import{l as H,z as U,m as G,A as W,d as P,B as Z,f as J}from"./firebase-vendor-AFMmvn69.js";import{L as K,A as Q}from"./lock-0xzitJgZ.js";/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=L("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=L("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),ae=()=>{var S;const{cartItems:m,clearCart:O}=$(),j=R(),d=_(),[h,C]=x.useState([]);x.useEffect(()=>{var t;(t=d.state)!=null&&t.directPurchase?C(d.state.directPurchase):C(m||[])},[d.state,m]),x.useEffect(()=>{var t;if((!m||m.length===0)&&!((t=d.state)!=null&&t.directPurchase)){const s=setTimeout(()=>j("/shop"),100);return()=>clearTimeout(s)}},[m,d.state,j]);const[n,E]=x.useState({email:"",firstName:"",lastName:"",address:"",apartment:"",city:"",state:"",pincode:"",phone:""}),[l,D]=x.useState(((S=d.state)==null?void 0:S.paymentMode)||"ONLINE"),[p,f]=x.useState(!1),I=151,y=h.reduce((t,s)=>{const a=Number(s.price||0)*Number(s.quantity||1),o=s.energization?I:0;return t+a+o},0),b=y>499?0:99,v=l==="COD"?49:0,w=y+b+v,i=t=>{const{name:s,value:a}=t.target;E(o=>({...o,[s]:a}))},q=async t=>{for(const s of t)try{const a=P(N,"products",s.id),o=await J(a);if(!o.exists())return{valid:!1,error:`Product "${s.name}" is no longer available.`};const g=o.data().stock||0;if(g<s.quantity)return{valid:!1,error:`Sorry, "${s.name}" is out of stock (Only ${g} left).`}}catch(a){return console.error("Stock check error:",a),{valid:!1,error:"System error checking stock. Please try again."}}return{valid:!0}},A=async t=>{var s;t.preventDefault(),f(!0);try{const a=await q(h);if(!a.valid){f(!1),k.error(a.error);return}const o={items:h.map(r=>({id:r.id,name:r.name,quantity:r.quantity,price:r.price,variant:r.variant||"Standard",image:r.featuredImageUrl||r.image||"",energization:r.energization||!1,energizationDetails:r.energizationDetails||null})),totalAmount:w,subtotal:y,shippingCost:b,codFee:v,shippingDetails:n,paymentMethod:l,status:"Pending",paymentStatus:l==="COD"?"Pending":"Paid",createdAt:H(),userEmail:n.email};await U(G(N,"orders"),o);const g=W(N);h.forEach(r=>{const T=P(N,"products",r.id);g.update(T,{stock:Z(-r.quantity)})}),await g.commit(),f(!1),(s=d.state)!=null&&s.directPurchase||O(),k.success("Order Placed Successfully!"),j("/order-success")}catch(a){console.error("Checkout Error:",a),k.error("Failed to place order. Please try again."),f(!1)}},c="w-full p-3 bg-gray-50 border border-gray-200 rounded text-sm outline-none transition-all focus:bg-white focus:border-[#B08D55] focus:ring-1 focus:ring-[#B08D55]";return e.jsxs("div",{className:"min-h-screen bg-gray-50 font-sans text-gray-900",children:[e.jsx("header",{className:"bg-white border-b border-gray-200 py-4 sticky top-0 z-50 shadow-sm",children:e.jsxs("div",{className:"container mx-auto px-4 flex items-center justify-between",children:[e.jsx(u,{to:"/",className:"flex items-center gap-2",children:e.jsx(F,{className:"h-6 md:h-8 w-auto text-[#B08D55]"})}),e.jsxs("div",{className:"flex items-center gap-2 text-[11px] uppercase tracking-wider font-bold text-[#B08D55] bg-orange-50 px-4 py-1.5 rounded-full border border-[#B08D55]/20",children:[e.jsx(K,{size:12})," Secure Checkout"]})]})}),e.jsxs("div",{className:"container mx-auto px-4 py-8 md:py-12",children:[e.jsxs("div",{className:"max-w-6xl mx-auto mb-8 flex items-center gap-2 text-[10px] font-bold text-gray-500 tracking-widest uppercase",children:[e.jsx(u,{to:"/",className:"hover:text-[#B08D55] transition-colors",children:"Home"}),e.jsx(B,{size:10}),e.jsx(u,{to:"/shop",className:"hover:text-[#B08D55] transition-colors",children:"Shop"}),e.jsx(B,{size:10}),e.jsx("span",{className:"text-gray-900",children:"Checkout"})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-8 lg:gap-12 max-w-6xl mx-auto",children:[e.jsx("div",{className:"w-full lg:w-[60%]",children:e.jsxs("form",{id:"checkout-form",onSubmit:A,className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"bg-white p-6 md:p-8 rounded-lg shadow-sm border border-gray-100",children:[e.jsxs("h2",{className:"font-heading text-xl font-bold mb-6 text-gray-900 flex items-center gap-3",children:[e.jsx("span",{className:"w-7 h-7 bg-black text-white rounded-full flex items-center justify-center text-sm font-sans",children:"1"}),"Contact Information"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"email",name:"email",required:!0,placeholder:"Email Address",value:n.email,onChange:i,className:c}),e.jsxs("div",{className:"flex items-start gap-2 text-xs text-gray-500",children:[e.jsx(Q,{size:14,className:"mt-0.5 text-[#B08D55]"}),"We'll send the order confirmation and tracking details here."]})]})]}),e.jsxs("div",{className:"bg-white p-6 md:p-8 rounded-lg shadow-sm border border-gray-100",children:[e.jsxs("h2",{className:"font-heading text-xl font-bold mb-6 text-gray-900 flex items-center gap-3",children:[e.jsx("span",{className:"w-7 h-7 bg-black text-white rounded-full flex items-center justify-center text-sm font-sans",children:"2"}),"Shipping Address"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",name:"firstName",required:!0,placeholder:"First Name",className:c,value:n.firstName,onChange:i}),e.jsx("input",{type:"text",name:"lastName",required:!0,placeholder:"Last Name",className:c,value:n.lastName,onChange:i}),e.jsx("input",{type:"text",name:"address",required:!0,placeholder:"Address",className:`md:col-span-2 ${c}`,value:n.address,onChange:i}),e.jsx("input",{type:"text",name:"city",required:!0,placeholder:"City",className:c,value:n.city,onChange:i}),e.jsx("input",{type:"text",name:"state",required:!0,placeholder:"State",className:c,value:n.state,onChange:i}),e.jsx("input",{type:"text",name:"pincode",required:!0,placeholder:"Pincode",maxLength:6,className:c,value:n.pincode,onChange:i}),e.jsx("input",{type:"tel",name:"phone",required:!0,placeholder:"Phone Number",maxLength:10,className:c,value:n.phone,onChange:i})]})]}),e.jsxs("div",{className:"bg-white p-6 md:p-8 rounded-lg shadow-sm border border-gray-100",children:[e.jsxs("h2",{className:"font-heading text-xl font-bold mb-6 text-gray-900 flex items-center gap-3",children:[e.jsx("span",{className:"w-7 h-7 bg-black text-white rounded-full flex items-center justify-center text-sm font-sans",children:"3"}),"Payment Method"]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("label",{className:`relative flex items-center gap-4 p-4 border rounded-lg cursor-pointer transition-all ${l==="ONLINE"?"border-[#B08D55] bg-orange-50/30 ring-1 ring-[#B08D55]/20":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"payment",value:"ONLINE",checked:l==="ONLINE",onChange:()=>D("ONLINE"),className:"accent-[#B08D55] w-5 h-5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-bold text-sm text-gray-900",children:"Pay Online"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"UPI, Cards, Netbanking (Fastest)"})]}),e.jsx(X,{className:l==="ONLINE"?"text-[#B08D55]":"text-gray-400"})]}),e.jsxs("label",{className:`relative flex items-center gap-4 p-4 border rounded-lg cursor-pointer transition-all ${l==="COD"?"border-[#B08D55] bg-orange-50/30 ring-1 ring-[#B08D55]/20":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"payment",value:"COD",checked:l==="COD",onChange:()=>D("COD"),className:"accent-[#B08D55] w-5 h-5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-bold text-sm text-gray-900",children:"Cash on Delivery"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Additional ₹49 Handling Fee"})]}),e.jsx(V,{className:l==="COD"?"text-[#B08D55]":"text-gray-400"})]})]})]}),e.jsx("div",{className:"lg:hidden fixed bottom-0 left-0 w-full p-4 bg-white border-t border-gray-200 z-40 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]",children:e.jsx("button",{type:"submit",disabled:p,className:"w-full bg-black text-white py-4 rounded-md font-bold text-sm uppercase tracking-widest hover:bg-[#B08D55] transition-colors disabled:bg-gray-400 flex items-center justify-center gap-2",children:p?e.jsx(z,{className:"animate-spin",size:18}):`Pay ₹${w.toLocaleString()}`})})]})}),e.jsx("div",{className:"w-full lg:w-[40%]",children:e.jsxs("div",{className:"bg-white p-6 md:p-8 rounded-lg shadow-sm border border-gray-100 sticky top-24",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"font-heading text-xl font-bold text-gray-900",children:"Order Summary"}),e.jsx("div",{className:"w-16 h-1 bg-[#B08D55] rounded-full mt-2"})]}),e.jsx("div",{className:"space-y-5 mb-6 max-h-[400px] overflow-y-auto pr-2 custom-scrollbar",children:h.map(t=>e.jsxs("div",{className:"flex gap-4 group",children:[e.jsx(u,{to:`/product/${t.id}`,className:"block w-16 h-20 flex-shrink-0",children:e.jsxs("div",{className:"w-full h-full bg-gray-100 rounded-md border border-gray-200 overflow-hidden relative",children:[e.jsx("img",{src:t.featuredImageUrl||t.image,alt:t.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}),e.jsx("span",{className:"absolute top-0 right-0 bg-gray-900 text-white text-[10px] w-5 h-5 flex items-center justify-center rounded-bl font-bold",children:t.quantity})]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(u,{to:`/product/${t.id}`,className:"hover:text-[#B08D55] transition-colors",children:e.jsx("h4",{className:"text-sm font-bold text-gray-900 line-clamp-2 leading-tight",children:t.name})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:t.variant||"Standard"}),t.energization&&e.jsxs("span",{className:"inline-flex items-center gap-1 mt-1 px-1.5 py-0.5 rounded bg-[#B08D55]/10 text-[#B08D55] text-[9px] font-bold uppercase",children:[e.jsx(CheckCircle2,{size:10})," Energized (+₹151)"]})]}),e.jsxs("div",{className:"text-sm font-bold text-gray-900 whitespace-nowrap",children:["₹",(Number(t.price)*Number(t.quantity)+(t.energization?151:0)).toLocaleString()]})]},t.id))}),e.jsxs("div",{className:"space-y-3 py-6 border-t border-dashed border-gray-200",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{className:"font-medium text-gray-900",children:["₹",y.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsx("span",{children:"Shipping"}),b===0?e.jsx("span",{className:"text-green-700 font-bold text-xs uppercase bg-green-50 px-2 py-0.5 rounded",children:"Free"}):e.jsxs("span",{className:"font-medium text-gray-900",children:["₹",b]})]}),l==="COD"&&e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsx("span",{children:"COD Handling"}),e.jsxs("span",{className:"font-medium text-gray-900",children:["₹",v]})]})]}),e.jsxs("div",{className:"flex justify-between items-center py-6 border-t border-gray-200 mb-6",children:[e.jsx("span",{className:"font-heading text-xl font-bold text-gray-900",children:"Total"}),e.jsxs("span",{className:"font-heading text-2xl font-bold text-[#B08D55]",children:["₹",w.toLocaleString()]})]}),e.jsx("button",{form:"checkout-form",type:"submit",disabled:p,className:"hidden lg:flex w-full bg-black text-white py-4 rounded-md font-bold text-sm uppercase tracking-widest hover:bg-[#B08D55] transition-all shadow-lg hover:shadow-xl hover:-translate-y-0.5 disabled:bg-gray-400 items-center justify-center gap-2",children:p?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"animate-spin",size:18})," Processing..."]}):"Place Order"}),e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-2 text-xs text-gray-400",children:[e.jsx(M,{size:14})," SSL Encrypted Transaction"]})]})})]})]})]})};export{ae as default};
